name: Claude Dual Agent Implementation

on:
  push:

jobs:
  generate-code:
    strategy:
      matrix:
        agent_id: [agent-a, agent-b]
    runs-on: ubuntu-latest
    name: Generate by ${{ matrix.agent_id }}
    steps:
      - uses: actions/checkout@v4

      - name: Install Claude CLI
        run: npm install -g @anthropic-ai/claude-code

      - name: Generate implementation with Claude
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          claude \
            -p "以下の仕様を満たす Python 関数 fizzbuzz を fizzbuzz.py に定義してください。整数 n を受け取り、3の倍数ならFizz、5の倍数ならBuzz、15の倍数ならFizzBuzz、それ以外はその数を文字列で返してください。" \
            > fizzbuzz_${{ matrix.agent_id }}.py

      - name: Save as module
        run: |
          mkdir -p modules/${{ matrix.agent_id }}
          echo "$(cat fizzbuzz_${{ matrix.agent_id }}.py)" > modules/${{ matrix.agent_id }}/fizzbuzz.py

      - name: Run test
        run: |
          cp -r tests .  # テストをコピー
          cp modules/${{ matrix.agent_id }}/fizzbuzz.py fizzbuzz.py
          pytest tests/ > test_result_${{ matrix.agent_id }}.txt || echo "テスト失敗"

      - name: Upload results
        uses: actions/upload-artifact@v4
        with:
          name: result-${{ matrix.agent_id }}
          path: |
            fizzbuzz_${{ matrix.agent_id }}.py
            test_result_${{ matrix.agent_id }}.txt

name: Todo App - Claudeä¸¦åˆ—é–‹ç™º

on:
  workflow_dispatch:
    inputs:
      development_target:
        description: "é–‹ç™ºå¯¾è±¡"
        required: true
        default: "both"
        type: choice
        options:
          - both
          - backend
          - frontend
      task_description:
        description: "é–‹ç™ºã‚¿ã‚¹ã‚¯ã®èª¬æ˜"
        required: true
        default: "TodoåŸºæœ¬æ©Ÿèƒ½ã®å®Ÿè£…"
      feature_scope:
        description: "æ©Ÿèƒ½ã‚¹ã‚³ãƒ¼ãƒ—"
        required: true
        default: "crud"
        type: choice
        options:
          - crud
          - authentication
          - ui_improvement
          - deployment

jobs:
  backend-development:
    if: ${{ github.event.inputs.development_target == 'backend' || github.event.inputs.development_target == 'both' }}
    strategy:
      matrix:
        agent_id: [backend-agent-a, backend-agent-b]
    runs-on: ubuntu-latest
    name: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–‹ç™º (${{ matrix.agent_id }})
    steps:
      - name: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: Node.jsç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-node@v4
        with:
          node-version: "18"

      - name: Claude CLI ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: npm install -g @anthropic-ai/claude-code

      - name: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…ã‚’ç”Ÿæˆ
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          echo "â–¶ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…ã‚’ç”Ÿæˆä¸­ (Agent: ${{ matrix.agent_id }})"

          # APIä»•æ§˜æ›¸ã‚’èª­ã¿è¾¼ã¿
          API_SPEC=$(cat todo-app/api-spec.md)

          # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ§‹ç¯‰
          BACKEND_PROMPT="Todo ã‚¢ãƒ—ãƒªã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã‚’ Node.js + Express ã§å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚

          ã‚¿ã‚¹ã‚¯: ${{ github.event.inputs.task_description }}
          æ©Ÿèƒ½ã‚¹ã‚³ãƒ¼ãƒ—: ${{ github.event.inputs.feature_scope }}

          APIä»•æ§˜:
          $API_SPEC

          è¦ä»¶:
          - Express.js ã‚’ä½¿ç”¨
          - SQLite ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
          - é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
          - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
          - CORSå¯¾å¿œ
          - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®

          å‡ºåŠ›: app.js ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å®Œå…¨ãªå®Ÿè£…ã‚’ç”Ÿæˆ"

          claude -p "$BACKEND_PROMPT" > backend_implementation_${{ matrix.agent_id }}.js

      - name: ç”Ÿæˆã•ã‚ŒãŸãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèª
        run: |
          echo "=== ç”Ÿæˆã•ã‚ŒãŸãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ (${{ matrix.agent_id }}) ==="
          cat backend_implementation_${{ matrix.agent_id }}.js

      - name: å®Ÿè£…ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã«é…ç½®
        run: |
          mkdir -p todo-app/backend-${{ matrix.agent_id }}/src
          cp backend_implementation_${{ matrix.agent_id }}.js todo-app/backend-${{ matrix.agent_id }}/src/app.js
          cp todo-app/backend/package.json todo-app/backend-${{ matrix.agent_id }}/
          cp -r todo-app/backend/tests todo-app/backend-${{ matrix.agent_id }}/

      - name: ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          cd todo-app/backend-${{ matrix.agent_id }}
          npm install

      - name: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
        run: |
          cd todo-app/backend-${{ matrix.agent_id }}
          npm test > test_result.txt 2>&1 || echo "ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸ"
          cat test_result.txt

      - name: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        uses: actions/upload-artifact@v4
        with:
          name: ${{ matrix.agent_id }}-results
          path: |
            todo-app/backend-${{ matrix.agent_id }}/src/app.js
            todo-app/backend-${{ matrix.agent_id }}/test_result.txt

  frontend-development:
    if: ${{ github.event.inputs.development_target == 'frontend' || github.event.inputs.development_target == 'both' }}
    strategy:
      matrix:
        agent_id: [frontend-agent-a, frontend-agent-b]
    runs-on: ubuntu-latest
    name: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™º (${{ matrix.agent_id }})
    steps:
      - name: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: Node.jsç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-node@v4
        with:
          node-version: "18"

      - name: Claude CLI ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: npm install -g @anthropic-ai/claude-code

      - name: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ã‚’ç”Ÿæˆ
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          echo "â–¶ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ã‚’ç”Ÿæˆä¸­ (Agent: ${{ matrix.agent_id }})"

          # APIä»•æ§˜æ›¸ã‚’èª­ã¿è¾¼ã¿
          API_SPEC=$(cat todo-app/api-spec.md)

          # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ§‹ç¯‰
          FRONTEND_PROMPT="Todo ã‚¢ãƒ—ãƒªã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’ React ã§å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚

          ã‚¿ã‚¹ã‚¯: ${{ github.event.inputs.task_description }}
          æ©Ÿèƒ½ã‚¹ã‚³ãƒ¼ãƒ—: ${{ github.event.inputs.feature_scope }}

          APIä»•æ§˜:
          $API_SPEC

          è¦ä»¶:
          - React + JavaScript
          - é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ + Hooks
          - Todoä¸€è¦§è¡¨ç¤ºã€è¿½åŠ ã€ç·¨é›†ã€å‰Šé™¤æ©Ÿèƒ½
          - ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
          - é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
          - ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã‚’è€ƒæ…®

          å‡ºåŠ›: App.js ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å®Œå…¨ãªå®Ÿè£…ã‚’ç”Ÿæˆ"

          claude -p "$FRONTEND_PROMPT" > frontend_implementation_${{ matrix.agent_id }}.js

      - name: ç”Ÿæˆã•ã‚ŒãŸãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèª
        run: |
          echo "=== ç”Ÿæˆã•ã‚ŒãŸãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ (${{ matrix.agent_id }}) ==="
          cat frontend_implementation_${{ matrix.agent_id }}.js

      - name: å®Ÿè£…ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã«é…ç½®
        run: |
          mkdir -p todo-app/frontend-${{ matrix.agent_id }}/src
          cp frontend_implementation_${{ matrix.agent_id }}.js todo-app/frontend-${{ matrix.agent_id }}/src/App.js
          cp todo-app/frontend/package.json todo-app/frontend-${{ matrix.agent_id }}/
          cp todo-app/frontend/src/App.test.js todo-app/frontend-${{ matrix.agent_id }}/src/

          # åŸºæœ¬çš„ãªindex.jsã‚’ä½œæˆ
          cat > todo-app/frontend-${{ matrix.agent_id }}/src/index.js << 'EOF'
          import React from 'react';
          import ReactDOM from 'react-dom/client';
          import App from './App';

          const root = ReactDOM.createRoot(document.getElementById('root'));
          root.render(<App />);
          EOF

      - name: ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          cd todo-app/frontend-${{ matrix.agent_id }}
          npm install

      - name: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
        run: |
          cd todo-app/frontend-${{ matrix.agent_id }}
          npm test -- --coverage --watchAll=false > test_result.txt 2>&1 || echo "ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸ"
          cat test_result.txt

      - name: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        uses: actions/upload-artifact@v4
        with:
          name: ${{ matrix.agent_id }}-results
          path: |
            todo-app/frontend-${{ matrix.agent_id }}/src/App.js
            todo-app/frontend-${{ matrix.agent_id }}/test_result.txt

  compare-and-integrate:
    needs: [backend-development, frontend-development]
    if: always()
    runs-on: ubuntu-latest
    name: çµæœæ¯”è¼ƒãƒ»çµ±åˆ
    steps:
      - name: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: å…¨ã¦ã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        uses: actions/download-artifact@v4

      - name: é–‹ç™ºçµæœã‚’æ¯”è¼ƒãƒ»åˆ†æ
        run: |
          echo "=== Todo App é–‹ç™ºçµæœæ¯”è¼ƒ ===" > integration_report.txt
          echo "ç”Ÿæˆæ—¥æ™‚: $(date)" >> integration_report.txt
          echo "é–‹ç™ºå¯¾è±¡: ${{ github.event.inputs.development_target }}" >> integration_report.txt
          echo "ã‚¿ã‚¹ã‚¯: ${{ github.event.inputs.task_description }}" >> integration_report.txt
          echo "" >> integration_report.txt

          # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰çµæœåˆ†æ
          if [ "${{ github.event.inputs.development_target }}" = "backend" ] || [ "${{ github.event.inputs.development_target }}" = "both" ]; then
            echo "## ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–‹ç™ºçµæœ" >> integration_report.txt
            echo "" >> integration_report.txt
            
            BEST_BACKEND=""
            for agent in backend-agent-a backend-agent-b; do
              echo "### $agent" >> integration_report.txt
              if [ -f "${agent}-results/test_result.txt" ]; then
                echo "ãƒ†ã‚¹ãƒˆçµæœ:" >> integration_report.txt
                cat "${agent}-results/test_result.txt" >> integration_report.txt
                
                if grep -q "PASS" "${agent}-results/test_result.txt" && [ -z "$BEST_BACKEND" ]; then
                  BEST_BACKEND=$agent
                  echo "âœ… æœ€é©ãªãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…ã¨ã—ã¦é¸æŠ" >> integration_report.txt
                fi
              fi
              echo "" >> integration_report.txt
            done
            
            echo "BEST_BACKEND=$BEST_BACKEND" >> $GITHUB_ENV
          fi

          # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çµæœåˆ†æ
          if [ "${{ github.event.inputs.development_target }}" = "frontend" ] || [ "${{ github.event.inputs.development_target }}" = "both" ]; then
            echo "## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºçµæœ" >> integration_report.txt
            echo "" >> integration_report.txt
            
            BEST_FRONTEND=""
            for agent in frontend-agent-a frontend-agent-b; do
              echo "### $agent" >> integration_report.txt
              if [ -f "${agent}-results/test_result.txt" ]; then
                echo "ãƒ†ã‚¹ãƒˆçµæœ:" >> integration_report.txt
                cat "${agent}-results/test_result.txt" >> integration_report.txt
                
                if grep -q "PASS" "${agent}-results/test_result.txt" && [ -z "$BEST_FRONTEND" ]; then
                  BEST_FRONTEND=$agent
                  echo "âœ… æœ€é©ãªãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ã¨ã—ã¦é¸æŠ" >> integration_report.txt
                fi
              fi
              echo "" >> integration_report.txt
            done
            
            echo "BEST_FRONTEND=$BEST_FRONTEND" >> $GITHUB_ENV
          fi

      - name: æ¯”è¼ƒãƒ¬ãƒãƒ¼ãƒˆã‚’è¡¨ç¤º
        run: cat integration_report.txt

      - name: çµ±åˆãƒ¬ãƒãƒ¼ãƒˆã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        uses: actions/upload-artifact@v4
        with:
          name: integration-report
          path: integration_report.txt

  generate-summary:
    needs: [backend-development, frontend-development, compare-and-integrate]
    runs-on: ubuntu-latest
    name: ğŸ“Š é–‹ç™ºã‚µãƒãƒªãƒ¼ç”Ÿæˆ
    if: always()
    steps:
      - name: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: å…¨ã¦ã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        uses: actions/download-artifact@v4

      - name: é–‹ç™ºã‚µãƒãƒªãƒ¼ã‚’ç”Ÿæˆ
        run: |
          echo "# ğŸš€ Todo App Claudeä¸¦åˆ—é–‹ç™ºã‚µãƒãƒªãƒ¼" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**é–‹ç™ºæ—¥æ™‚**: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "**é–‹ç™ºå¯¾è±¡**: ${{ github.event.inputs.development_target }}" >> $GITHUB_STEP_SUMMARY
          echo "**ã‚¿ã‚¹ã‚¯**: ${{ github.event.inputs.task_description }}" >> $GITHUB_STEP_SUMMARY
          echo "**æ©Ÿèƒ½ã‚¹ã‚³ãƒ¼ãƒ—**: ${{ github.event.inputs.feature_scope }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰çµæœã‚µãƒãƒªãƒ¼
          if [ "${{ github.event.inputs.development_target }}" = "backend" ] || [ "${{ github.event.inputs.development_target }}" = "both" ]; then
            echo "## ğŸ”§ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–‹ç™ºçµæœ" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            
            BACKEND_SUCCESS_COUNT=0
            for agent in backend-agent-a backend-agent-b; do
              echo "### ${agent}" >> $GITHUB_STEP_SUMMARY
              if [ -f "${agent}-results/test_result.txt" ]; then
                if grep -q "PASS" "${agent}-results/test_result.txt" 2>/dev/null; then
                  echo "- âœ… **å®Ÿè£…çµæœ**: æˆåŠŸ" >> $GITHUB_STEP_SUMMARY
                  echo "- ğŸ“ **ãƒ•ã‚¡ã‚¤ãƒ«**: \`todo-app/backend/src/app.js\`" >> $GITHUB_STEP_SUMMARY
                  echo "- ğŸ§ª **ãƒ†ã‚¹ãƒˆ**: é€šé" >> $GITHUB_STEP_SUMMARY
                  BACKEND_SUCCESS_COUNT=$((BACKEND_SUCCESS_COUNT + 1))
                else
                  echo "- âŒ **å®Ÿè£…çµæœ**: å¤±æ•—" >> $GITHUB_STEP_SUMMARY
                  echo "- ğŸ§ª **ãƒ†ã‚¹ãƒˆ**: å¤±æ•—" >> $GITHUB_STEP_SUMMARY
                fi
                
                # ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºæƒ…å ±
                if [ -f "${agent}-results/app.js" ]; then
                  LINES=$(wc -l < "${agent}-results/app.js" 2>/dev/null || echo "0")
                  echo "- ğŸ“ **ã‚³ãƒ¼ãƒ‰è¡Œæ•°**: ${LINES}è¡Œ" >> $GITHUB_STEP_SUMMARY
                fi
              else
                echo "- âš ï¸ **å®Ÿè£…çµæœ**: ãƒ†ã‚¹ãƒˆçµæœãªã—" >> $GITHUB_STEP_SUMMARY
              fi
              echo "" >> $GITHUB_STEP_SUMMARY
            done
            
            # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æˆåŠŸç‡
            echo "**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æˆåŠŸç‡**: ${BACKEND_SUCCESS_COUNT}/2 ($(( BACKEND_SUCCESS_COUNT * 50 ))%)" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi

          # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çµæœã‚µãƒãƒªãƒ¼
          if [ "${{ github.event.inputs.development_target }}" = "frontend" ] || [ "${{ github.event.inputs.development_target }}" = "both" ]; then
            echo "## ğŸ¨ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºçµæœ" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            
            FRONTEND_SUCCESS_COUNT=0
            for agent in frontend-agent-a frontend-agent-b; do
              echo "### ${agent}" >> $GITHUB_STEP_SUMMARY
              if [ -f "${agent}-results/test_result.txt" ]; then
                if grep -q "PASS" "${agent}-results/test_result.txt" 2>/dev/null; then
                  echo "- âœ… **å®Ÿè£…çµæœ**: æˆåŠŸ" >> $GITHUB_STEP_SUMMARY
                  echo "- ğŸ“ **ãƒ•ã‚¡ã‚¤ãƒ«**: \`todo-app/frontend/src/App.js\`" >> $GITHUB_STEP_SUMMARY
                  echo "- ğŸ§ª **ãƒ†ã‚¹ãƒˆ**: é€šé" >> $GITHUB_STEP_SUMMARY
                  FRONTEND_SUCCESS_COUNT=$((FRONTEND_SUCCESS_COUNT + 1))
                else
                  echo "- âŒ **å®Ÿè£…çµæœ**: å¤±æ•—" >> $GITHUB_STEP_SUMMARY
                  echo "- ğŸ§ª **ãƒ†ã‚¹ãƒˆ**: å¤±æ•—" >> $GITHUB_STEP_SUMMARY
                fi
                
                # ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºæƒ…å ±
                if [ -f "${agent}-results/App.js" ]; then
                  LINES=$(wc -l < "${agent}-results/App.js" 2>/dev/null || echo "0")
                  echo "- ğŸ“ **ã‚³ãƒ¼ãƒ‰è¡Œæ•°**: ${LINES}è¡Œ" >> $GITHUB_STEP_SUMMARY
                fi
              else
                echo "- âš ï¸ **å®Ÿè£…çµæœ**: ãƒ†ã‚¹ãƒˆçµæœãªã—" >> $GITHUB_STEP_SUMMARY
              fi
              echo "" >> $GITHUB_STEP_SUMMARY
            done
            
            # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æˆåŠŸç‡
            echo "**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æˆåŠŸç‡**: ${FRONTEND_SUCCESS_COUNT}/2 ($(( FRONTEND_SUCCESS_COUNT * 50 ))%)" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi

      - name: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ€§èƒ½æ¯”è¼ƒ
        run: |
          echo "## ğŸ† ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ€§èƒ½æ¯”è¼ƒ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ | å®Ÿè£…çµæœ | ãƒ†ã‚¹ãƒˆçµæœ | ã‚³ãƒ¼ãƒ‰è¡Œæ•° | å“è³ªã‚¹ã‚³ã‚¢ |" >> $GITHUB_STEP_SUMMARY
          echo "|-------------|----------|------------|------------|------------|" >> $GITHUB_STEP_SUMMARY

          # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
          if [ "${{ github.event.inputs.development_target }}" = "backend" ] || [ "${{ github.event.inputs.development_target }}" = "both" ]; then
            for agent in backend-agent-a backend-agent-b; do
              if [ -f "${agent}-results/test_result.txt" ]; then
                LINES=$(wc -l < "${agent}-results/app.js" 2>/dev/null || echo "0")
                if grep -q "PASS" "${agent}-results/test_result.txt" 2>/dev/null; then
                  echo "| $agent | âœ… æˆåŠŸ | âœ… é€šé | ${LINES} | â­â­â­â­ |" >> $GITHUB_STEP_SUMMARY
                else
                  echo "| $agent | âŒ å¤±æ•— | âŒ å¤±æ•— | ${LINES} | â­â­ |" >> $GITHUB_STEP_SUMMARY
                fi
              fi
            done
          fi

          # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
          if [ "${{ github.event.inputs.development_target }}" = "frontend" ] || [ "${{ github.event.inputs.development_target }}" = "both" ]; then
            for agent in frontend-agent-a frontend-agent-b; do
              if [ -f "${agent}-results/test_result.txt" ]; then
                LINES=$(wc -l < "${agent}-results/App.js" 2>/dev/null || echo "0")
                if grep -q "PASS" "${agent}-results/test_result.txt" 2>/dev/null; then
                  echo "| $agent | âœ… æˆåŠŸ | âœ… é€šé | ${LINES} | â­â­â­â­ |" >> $GITHUB_STEP_SUMMARY
                else
                  echo "| $agent | âŒ å¤±æ•— | âŒ å¤±æ•— | ${LINES} | â­â­ |" >> $GITHUB_STEP_SUMMARY
                fi
              fi
            done
          fi

      - name: çµ±åˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤æƒ…å ±
        run: |
          echo "## ğŸ”„ çµ±åˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤çŠ¶æ³" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # ãƒ–ãƒ©ãƒ³ãƒæƒ…å ±
          BRANCH_NAME="claude-todo-app-$(date +%Y%m%d-%H%M%S)"
          echo "- ğŸŒ¿ **ä½œæˆäºˆå®šãƒ–ãƒ©ãƒ³ãƒ**: \`$BRANCH_NAME\`" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ“ **ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**: è‡ªå‹•ä½œæˆäºˆå®š" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ“Š **è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆ**: \`todo-app/claude_development_report.txt\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # é–‹ç™ºé€²æ—ã®å¯è¦–åŒ–
          echo "## ğŸ¯ é–‹ç™ºé€²æ—" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          if [ "${{ github.event.inputs.development_target }}" = "backend" ] || [ "${{ github.event.inputs.development_target }}" = "both" ]; then
            echo "### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–‹ç™º" >> $GITHUB_STEP_SUMMARY
            echo "ğŸ”´â¡ï¸ğŸŸ¢ **TDDãƒ—ãƒ­ã‚»ã‚¹**: èµ¤ â†’ ç·‘" >> $GITHUB_STEP_SUMMARY
            echo "- âœ… APIè¨­è¨ˆå®Œäº†" >> $GITHUB_STEP_SUMMARY
            echo "- âœ… å®Ÿè£…å®Œäº†" >> $GITHUB_STEP_SUMMARY
            echo "- âœ… ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå®Œäº†" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi

          if [ "${{ github.event.inputs.development_target }}" = "frontend" ] || [ "${{ github.event.inputs.development_target }}" = "both" ]; then
            echo "### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™º" >> $GITHUB_STEP_SUMMARY
            echo "ğŸ¨â¡ï¸ğŸ“± **UI/UX**: ãƒ‡ã‚¶ã‚¤ãƒ³ â†’ å®Ÿè£…" >> $GITHUB_STEP_SUMMARY
            echo "- âœ… ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆå®Œäº†" >> $GITHUB_STEP_SUMMARY
            echo "- âœ… å®Ÿè£…å®Œäº†" >> $GITHUB_STEP_SUMMARY
            echo "- âœ… ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå®Œäº†" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi

      - name: æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨ã‚³ãƒãƒ³ãƒ‰
        run: |
          echo "## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "1. ğŸ“‹ ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼" >> $GITHUB_STEP_SUMMARY
          echo "2. ğŸ§ª ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ" >> $GITHUB_STEP_SUMMARY
          echo "3. ğŸš€ ãƒãƒ¼ã‚¸ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ä¾‹
          echo "## ğŸ’» ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`bash" >> $GITHUB_STEP_SUMMARY
          if [ "${{ github.event.inputs.development_target }}" = "backend" ] || [ "${{ github.event.inputs.development_target }}" = "both" ]; then
            echo "# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰èµ·å‹•" >> $GITHUB_STEP_SUMMARY
            echo "cd todo-app/backend" >> $GITHUB_STEP_SUMMARY
            echo "npm install && npm start" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi
          if [ "${{ github.event.inputs.development_target }}" = "frontend" ] || [ "${{ github.event.inputs.development_target }}" = "both" ]; then
            echo "# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èµ·å‹•ï¼ˆåˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰" >> $GITHUB_STEP_SUMMARY
            echo "cd todo-app/frontend" >> $GITHUB_STEP_SUMMARY
            echo "npm install && npm start" >> $GITHUB_STEP_SUMMARY
          fi
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹
          echo "## ğŸ“ˆ å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ¤– **ä½¿ç”¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ•°**: 4å€‹ï¼ˆbackend-a, backend-b, frontend-a, frontend-bï¼‰" >> $GITHUB_STEP_SUMMARY
          echo "- â±ï¸ **æ¨å®šå®Ÿè¡Œæ™‚é–“**: 5-10åˆ†" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ”„ **ä¸¦åˆ—å‡¦ç†**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ»ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰åŒæ™‚é–‹ç™º" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ“Š **è‡ªå‹•å“è³ªè©•ä¾¡**: ãƒ†ã‚¹ãƒˆçµæœã«ã‚ˆã‚‹å®Ÿè£…é¸æŠ" >> $GITHUB_STEP_SUMMARY

  create-implementation-pr:
    needs: [compare-and-integrate, generate-summary]
    runs-on: ubuntu-latest
    name: å®Ÿè£…PRä½œæˆ
    if: success()
    steps:
      - name: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: å…¨ã¦ã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        uses: actions/download-artifact@v4

      - name: æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
        run: |
          BRANCH_NAME="claude-todo-app-$(date +%Y%m%d-%H%M%S)"
          git checkout -b $BRANCH_NAME
          echo "BRANCH_NAME=$BRANCH_NAME" >> $GITHUB_ENV

      - name: æœ€é©ãªå®Ÿè£…ã‚’çµ±åˆ
        run: |
          # æœ€é©ãªå®Ÿè£…ã‚’é¸æŠã—ã¦ã‚³ãƒ”ãƒ¼
          if [ "${{ github.event.inputs.development_target }}" = "backend" ] || [ "${{ github.event.inputs.development_target }}" = "both" ]; then
            for agent in backend-agent-a backend-agent-b; do
              if [ -f "${agent}-results/app.js" ]; then
                if grep -q "PASS" "${agent}-results/test_result.txt" 2>/dev/null; then
                  cp "${agent}-results/app.js" "todo-app/backend/src/app.js"
                  echo "ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…ã‚’ $agent ã‹ã‚‰çµ±åˆã—ã¾ã—ãŸ"
                  break
                fi
              fi
            done
          fi

          if [ "${{ github.event.inputs.development_target }}" = "frontend" ] || [ "${{ github.event.inputs.development_target }}" = "both" ]; then
            for agent in frontend-agent-a frontend-agent-b; do
              if [ -f "${agent}-results/App.js" ]; then
                if grep -q "PASS" "${agent}-results/test_result.txt" 2>/dev/null; then
                  cp "${agent}-results/App.js" "todo-app/frontend/src/App.js"
                  echo "ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ã‚’ $agent ã‹ã‚‰çµ±åˆã—ã¾ã—ãŸ"
                  break
                fi
              fi
            done
          fi

          # çµ±åˆãƒ¬ãƒãƒ¼ãƒˆã‚‚ã‚³ãƒ”ãƒ¼
          cp integration-report/integration_report.txt "todo-app/claude_development_report.txt"

      - name: Gitè¨­å®š
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "Claude Todo App Developer"

      - name: å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ
        run: |
          git add todo-app/
          git commit -m "Add Claude-generated Todo App implementation

          Target: ${{ github.event.inputs.development_target }}
          Task: ${{ github.event.inputs.task_description }}
          Scope: ${{ github.event.inputs.feature_scope }}

          ğŸ¤– Generated with Claude Code via GitHub Actions

          Co-Authored-By: Claude <noreply@anthropic.com>"

      - name: ãƒ–ãƒ©ãƒ³ãƒã‚’ãƒ—ãƒƒã‚·ãƒ¥
        run: git push origin $BRANCH_NAME

      - name: ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆ
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh pr create --title "ğŸš€ Todo App: ${{ github.event.inputs.task_description }}" --body "$(cat <<'EOF'
          ## ğŸ“± Todo App å®Ÿè£…

          **é–‹ç™ºå¯¾è±¡**: ${{ github.event.inputs.development_target }}
          **ã‚¿ã‚¹ã‚¯**: ${{ github.event.inputs.task_description }}
          **æ©Ÿèƒ½ã‚¹ã‚³ãƒ¼ãƒ—**: ${{ github.event.inputs.feature_scope }}

          ## ğŸ”§ å®Ÿè£…å†…å®¹

          Claudeä¸¦åˆ—é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚ŒãŸTodo ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…ã§ã™ã€‚

          ### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
          - Node.js + Express
          - SQLite ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
          - REST API (CRUDæ“ä½œ)
          - é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

          ### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
          - React + JavaScript
          - é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ + Hooks
          - ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
          - APIçµ±åˆ

          ## ğŸ“Š é–‹ç™ºåˆ†æ

          è©³ç´°ãªé–‹ç™ºåˆ†æã¯ `todo-app/claude_development_report.txt` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

          ## âœ… ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚¤ãƒ³ãƒˆ

          - [ ] APIä»•æ§˜ã®æº–æ‹ ç¢ºèª
          - [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å¦¥å½“æ€§
          - [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ç¢ºèª
          - [ ] UIã®ä½¿ã„ã‚„ã™ã•
          - [ ] ãƒ†ã‚¹ãƒˆã®ç¶²ç¾…æ€§
          - [ ] ã‚³ãƒ¼ãƒ‰ã®å“è³ªãƒ»ä¿å®ˆæ€§

          ## ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

          ```bash
          # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
          cd todo-app/backend
          npm install
          npm test

          # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
          cd todo-app/frontend
          npm install
          npm test
          ```

          ## ğŸš€ å‹•ä½œç¢ºèª

          ```bash
          # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰èµ·å‹•
          cd todo-app/backend
          npm start

          # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èµ·å‹•ï¼ˆåˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰
          cd todo-app/frontend
          npm start
          ```

          ---

          ğŸ¤– **è‡ªå‹•ç”Ÿæˆ**: ã“ã®PRã¯GitHub Actions + Claude Code ã«ã‚ˆã£ã¦è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸ

          **Co-Authored-By**: Claude <noreply@anthropic.com>
          EOF
          )"
